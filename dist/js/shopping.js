"use strict";$(function(){decodeURI(location.search).slice(1);var a=Cookie.get("bb");console.log(a),a?(console.log(123),$(".aa").html(""+a),$(".aa").next().next().html(" [退出]")):$(".aa").click(function(){window.open("html/denglu.html")}),$(".cc").click(function(){Cookie.set("bb","",{path:"/"}),location.reload()}),$.ajax({type:"get",url:"../api/shopping.php",data:{way:"shop"},async:!0,success:function(a){var c=JSON.parse(a).map(function(a){return'<ul class="single_goods" data-id='+a.id+'>\n                            <li class="single_1">\n                                <p><input type="checkbox" class="goods_checkbox" /></p>\n                            </li>\n                            <li class="single_2">\n                                <dl class="clearfix">\n                                    <dt>\n                                        <a href="javascript:;"><img src="'+a.path+'" alt="" /></a>\n                                    </dt>\n                                    <dd>\n                                        <a href="javascript:;">'+a.book+'</a>\n                                    </dd>\n                                </dl>\n                            </li>\n                            <li class="single_3">\n                                <p>￥<i>'+a.cost+'</i></p>\n                            </li>\n                            <li class="single_4">\n                            <p>￥<i class="unit_price">'+a.pirce+'</i></p>\n                            </li>\n                            <li class="single_5">\n                                <a href="javascript:;" class="num_less">-</a><input type="text" value="'+a.num+'" class="nums" /><a href="javascript:;" class="num_add">+</a>\n                            </li>\n                            <li class="single_6">\n                                <i class="single_66">'+(a.num*a.pirce).toFixed(2)+'</i>\n                            </li>\n                            <li class="single_7">\n                                <a href="javascript:;" class="delete_goods">删除</a>\n                                <a href="javascript:;" class="in_favorites">移入收藏</a>\n                            </li>\n                        </ul>'}).join("");$(".car_c").append(c)}});var s=[],l=[];function n(a){var c=a.parent().find("input").val(),n=a.parent().prev().find(".unit_price").text();console.log(n);var e=(c*(n=$.trim(n))).toFixed(2);console.log(e),a.parent().next().html('￥<i class="single_66">'+e+"</i>"),t()}$(".car_c").on("click",".single_5 .num_add",function(){var a=$(this).prev().val();100<=++a&&(a=100);var c=$(this).parent().parent().attr("data-id");$.ajax({type:"get",url:"../api/shopping.php",async:!0,data:{id:c,num:a,way:"num"},success:function(a){}}),$(this).prev().val(a),n($(this))}),$(".car_c").on("click",".single_5 .num_less",function(){var a=$(this).next().val();--a<=1&&(a=1);var c=$(this).parent().parent().attr("data-id");$.ajax({type:"get",url:"../api/shopping.php",async:!0,data:{id:c,num:a,way:"num"},success:function(a){}}),$(this).next().val(a),n($(this))}),$(".car_c").on("keyup",".single_5 .nums",function(){var a=$(this).val(),c=$(this).parent().parent().attr("data-id");100<=a&&(a=100),a<=1&&(a=1),$.ajax({type:"get",url:"../api/shopping.php",async:!0,data:{id:c,num:a,way:"num"},success:function(a){}}),$(this).val(a),n($(this))}),$(".car_c").on("click",".delete_goods",function(){if(confirm("您确定要删除该行吗？")){$(this).parent().parent().remove();var a=$(this).parent().parent().attr("data-id");$.ajax({type:"get",url:"../api/shopping.php",async:!0,data:{id:a,way:"del"},success:function(a){}})}t(),e()});var c=!0;function t(){s.length=0,l.length=0;for(var a=$(".car_c .goods_checkbox").size(),c=0;c<a;c++)if($(".car_c .goods_checkbox").eq(c).prop("checked")){s.push(c);var n=$(".goods_checkbox").eq(c).parent().parent().parent().attr("data-id");l.push(n)}var e=0,t=0;for(c=0;c<s.length;c++){e+=1*$(".nums").eq(s[c]).val();var i=$(".single_66").eq(s[c]).text();console.log(i),t+=1*i}$(".quantity").html(e),$(".balance_num i").html(e),$(".balance_price i").html("￥"+t.toFixed(2))}function e(){$(".goods_checkbox").size()}$(".checkAll").on("click",function(){c?($(".car_c").find(".goods_checkbox").prop("checked","checked"),$(".checkAll").prop("checked","checked")):($(".checkAll").removeAttr("checked"),$(".car_c .goods_checkbox").removeAttr("checked")),c=!c,t()}),$(".car_c").on("click",".goods_checkbox",function(){$(this).css("background","red"),t(),c=s.length==$(".goods_checkbox").size()?($(".checkAll").prop("checked","checked"),!1):($(".checkAll").removeAttr("checked"),!0)}),$(".balance_del").on("click",function(){if(t(),confirm("您确定要删除多行吗？"))for(var a=s.length-1;0<=a;a--)$(".goods_checkbox").eq(s[a]).parent().parent().parent().remove(),$.ajax({type:"get",url:"../api/shopping.php",async:!0,data:{id:l[a],way:"del"},success:function(a){}});e()}),e()});